<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>aa: ConcurrentAutoTable.java Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">aa
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d5/d35/a00266_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ConcurrentAutoTable.java</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d5/d35/a00266.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">package </span>com.cliffc.aa.util;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> java.io.Serializable;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span> java.util.concurrent.atomic.AtomicReferenceFieldUpdater; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160; </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">import</span> sun.misc.Unsafe;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html">   19</a></span>&#160;<span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="../../da/dcf/a01558.html">ConcurrentAutoTable</a> <span class="keyword">implements</span> Serializable {</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="comment">// --- public interface ---</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a4b0bab4576aff6bfb017f0d1c794bef3">   30</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dcf/a01558.html#a4b0bab4576aff6bfb017f0d1c794bef3">add</a>( <span class="keywordtype">long</span> x ) { <a class="code" href="../../da/dcf/a01558.html#a262459cb28d48e079a9990d40aaad390">add_if</a>(  x); }</div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#ad08d068d18aeb3d9164469a26e899c16">   32</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dcf/a01558.html#ad08d068d18aeb3d9164469a26e899c16">decrement</a>()   { <a class="code" href="../../da/dcf/a01558.html#a262459cb28d48e079a9990d40aaad390">add_if</a>(-1L); }</div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#adccbe6ece72427d36b0cc5492c0146ce">   34</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dcf/a01558.html#adccbe6ece72427d36b0cc5492c0146ce">increment</a>()   { <a class="code" href="../../da/dcf/a01558.html#a262459cb28d48e079a9990d40aaad390">add_if</a>( 1L); }</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#ad4dee04d13507d28af4d2d06ef156278">   39</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">void</span> <span class="keyword">set</span>( <span class="keywordtype">long</span> x ) { </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="../../d2/dc1/a01562.html">CAT</a> newcat = <span class="keyword">new</span> <a class="code" href="../../d2/dc1/a01562.html">CAT</a>(<span class="keyword">null</span>,4,x);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// Spin until CAS works</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">while</span>( !<a class="code" href="../../da/dcf/a01558.html#a095c4286914eb55093fddc6876df6fc9">CAS_cat</a>(<a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a>,newcat) ) {<span class="comment">/*empty*/</span>}</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  }</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a0829d01be3a5a0269feb836ed02db8f2">   50</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">long</span> <span class="keyword">get</span>()       { <span class="keywordflow">return</span>      <a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a>.<a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a>(); }</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a28979aa10c189b26a39f1d3e9a036fd1">   52</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">int</span>  <a class="code" href="../../da/dcf/a01558.html#a28979aa10c189b26a39f1d3e9a036fd1">intValue</a>()  { <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)<a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a>.<a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a>(); }</div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#ae319283f373baf9a27b4e2805e91bcd1">   54</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">long</span> <a class="code" href="../../da/dcf/a01558.html#ae319283f373baf9a27b4e2805e91bcd1">longValue</a>() { <span class="keywordflow">return</span>      <a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a>.<a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a>(); }</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a9344a8223e6fa082967da3a2a9a537ae">   60</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">long</span> <a class="code" href="../../da/dcf/a01558.html#a9344a8223e6fa082967da3a2a9a537ae">estimate_get</a>( ) { <span class="keywordflow">return</span> <a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a>.<a class="code" href="../../d2/dc1/a01562.html#a0f817e0a3eea4bb0474428009259f2b9">estimate_sum</a>(); }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a2d4cc656fb2580d38b6869c9446afcba">   65</a></span>&#160;  <span class="keyword">public</span> String <a class="code" href="../../da/dcf/a01558.html#a2d4cc656fb2580d38b6869c9446afcba">toString</a>() { <span class="keywordflow">return</span> <a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a>.<a class="code" href="../../d2/dc1/a01562.html#a92e61323c0d2d87797fe718bec33d73e">toString</a>(); }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  </div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a21fbbc25644149af7ad5113ebab0793c">   71</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dcf/a01558.html#a21fbbc25644149af7ad5113ebab0793c">print</a>() { <a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a>.<a class="code" href="../../d2/dc1/a01562.html#aa2ccbbf505dfab8df97bb755755c3cdd">print</a>(); }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a9d51e34cdb03418620b2facb902b74dc">   77</a></span>&#160;  <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="../../da/dcf/a01558.html#a9d51e34cdb03418620b2facb902b74dc">internal_size</a>() { <span class="keywordflow">return</span> <a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a>.<a class="code" href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">_t</a>.length; }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// Only add &#39;x&#39; to some slot in table, hinted at by &#39;hash&#39;.  The sum can</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">// overflow.  Value is CAS&#39;d so no counts are lost.  The CAS is retried until</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// it succeeds.  Returned value is the old value.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a262459cb28d48e079a9990d40aaad390">   82</a></span>&#160;  <span class="keyword">private</span> <span class="keywordtype">long</span> <a class="code" href="../../da/dcf/a01558.html#a262459cb28d48e079a9990d40aaad390">add_if</a>( <span class="keywordtype">long</span> x ) { <span class="keywordflow">return</span> <a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a>.<a class="code" href="../../d2/dc1/a01562.html#a7336896360f0eba7bbb60ccaea2a5737">add_if</a>(x,<a class="code" href="../../da/dcf/a01558.html#a074036c1c16302eaab17311aa96809ab">hash</a>(),<span class="keyword">this</span>); }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// The underlying array of concurrently updated long counters</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">   85</a></span>&#160;  <span class="keyword">private</span> <span class="keyword">volatile</span> <a class="code" href="../../d2/dc1/a01562.html">CAT</a> <a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a> = <span class="keyword">new</span> <a class="code" href="../../d2/dc1/a01562.html">CAT</a>(<span class="keyword">null</span>,16<span class="comment">/*Start Small, Think Big!*/</span>,0L);</div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a08789856105b475f7dd0988b78e96e84">   86</a></span>&#160;  <span class="keyword">private</span> <span class="keyword">static</span> AtomicReferenceFieldUpdater&lt;ConcurrentAutoTable,CAT&gt; <a class="code" href="../../da/dcf/a01558.html#a08789856105b475f7dd0988b78e96e84">_catUpdater</a> =</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    AtomicReferenceFieldUpdater.newUpdater(<a class="code" href="../../da/dcf/a01558.html">ConcurrentAutoTable</a>.class,<a class="code" href="../../d2/dc1/a01562.html">CAT</a>.class, <span class="stringliteral">&quot;_cat&quot;</span>);</div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a095c4286914eb55093fddc6876df6fc9">   88</a></span>&#160;  <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="../../da/dcf/a01558.html#a095c4286914eb55093fddc6876df6fc9">CAS_cat</a>( <a class="code" href="../../d2/dc1/a01562.html">CAT</a> oldcat, <a class="code" href="../../d2/dc1/a01562.html">CAT</a> newcat ) { <span class="keywordflow">return</span> <a class="code" href="../../da/dcf/a01558.html#a08789856105b475f7dd0988b78e96e84">_catUpdater</a>.compareAndSet(<span class="keyword">this</span>,oldcat,newcat); }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// Hash spreader</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="../../da/dcf/a01558.html#a074036c1c16302eaab17311aa96809ab">   91</a></span>&#160;  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/dcf/a01558.html#a074036c1c16302eaab17311aa96809ab">hash</a>() {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">//int h = (int)Thread.currentThread().getId();</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordtype">int</span> h = System.identityHashCode(Thread.currentThread());</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">return</span> h&lt;&lt;3;                <span class="comment">// Pad out cache lines.  The goal is to avoid cache-line contention</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// --- CAT -----------------------------------------------------------------</span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html">   98</a></span>&#160;  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class </span><a class="code" href="../../d2/dc1/a01562.html">CAT</a> <span class="keyword">implements</span> Serializable {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Unsafe crud: get a function which will CAS arrays</span></div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a8d374ee0df140cb2d575e357d2a64311">  101</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe <a class="code" href="../../d2/dc1/a01562.html#a8d374ee0df140cb2d575e357d2a64311">_unsafe</a> = <a class="code" href="../../d7/d94/a01642.html">UtilUnsafe</a>.<a class="code" href="../../d7/d94/a01642.html#a2fcd3c4eb083b744f168496baef1afa0">getUnsafe</a>();</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a7ddee6cfccf05d9228d0052f54bbf8cc">  102</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dc1/a01562.html#a7ddee6cfccf05d9228d0052f54bbf8cc">_Lbase</a>  = <a class="code" href="../../d2/dc1/a01562.html#a8d374ee0df140cb2d575e357d2a64311">_unsafe</a>.arrayBaseOffset(<span class="keywordtype">long</span>[].<span class="keyword">class</span>);</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#afaab6494573adfe81eed0a4c826714b8">  103</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dc1/a01562.html#afaab6494573adfe81eed0a4c826714b8">_Lscale</a> = <a class="code" href="../../d2/dc1/a01562.html#a8d374ee0df140cb2d575e357d2a64311">_unsafe</a>.arrayIndexScale(<span class="keywordtype">long</span>[].<span class="keyword">class</span>);</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#aa608923d1601362028a28e0b5f3b8d9a">  104</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">long</span> <a class="code" href="../../d2/dc1/a01562.html#aa608923d1601362028a28e0b5f3b8d9a">rawIndex</a>(<span class="keywordtype">long</span>[] ary, <span class="keywordtype">int</span> i) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      assert i &gt;= 0 &amp;&amp; i &lt; ary.length;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/dc1/a01562.html#a7ddee6cfccf05d9228d0052f54bbf8cc">_Lbase</a> + i * <a class="code" href="../../d2/dc1/a01562.html#afaab6494573adfe81eed0a4c826714b8">_Lscale</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a6db7031609cd9694b857ef0014406fac">  108</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">boolean</span> <a class="code" href="../../d2/dc1/a01562.html#a6db7031609cd9694b857ef0014406fac">CAS</a>( <span class="keywordtype">long</span>[] A, <span class="keywordtype">int</span> idx, <span class="keywordtype">long</span> old, <span class="keywordtype">long</span> nnn ) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/dc1/a01562.html#a8d374ee0df140cb2d575e357d2a64311">_unsafe</a>.compareAndSwapLong( A, <a class="code" href="../../d2/dc1/a01562.html#aa608923d1601362028a28e0b5f3b8d9a">rawIndex</a>(A,idx), old, nnn );</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">//volatile long _resizers;    // count of threads attempting a resize</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">//static private final AtomicLongFieldUpdater&lt;CAT&gt; _resizerUpdater =</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">//  AtomicLongFieldUpdater.newUpdater(CAT.class, &quot;_resizers&quot;);</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a6a0bfc6d7e6d7250b5b5056d2b990c77">  116</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">final</span> <a class="code" href="../../d2/dc1/a01562.html">CAT</a> <a class="code" href="../../d2/dc1/a01562.html#a6a0bfc6d7e6d7250b5b5056d2b990c77">_next</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a530f45dbf243605aca8324816e39a4d6">  117</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keywordtype">long</span> <a class="code" href="../../d2/dc1/a01562.html#a530f45dbf243605aca8324816e39a4d6">_fuzzy_sum_cache</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a95bdb4fcf5ea2938883b7b173639edb8">  118</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keywordtype">long</span> <a class="code" href="../../d2/dc1/a01562.html#a95bdb4fcf5ea2938883b7b173639edb8">_fuzzy_time</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a3176a8c1a34bbbf93a7bc4713177b4a1">  119</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dc1/a01562.html#a3176a8c1a34bbbf93a7bc4713177b4a1">MAX_SPIN</a>=1;</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">  120</a></span>&#160;    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keywordtype">long</span>[] <a class="code" href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">_t</a>;     <span class="comment">// Power-of-2 array of longs</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#ae0d22a9ee9f18152ca66f36600372c3b">  122</a></span>&#160;    <a class="code" href="../../d2/dc1/a01562.html#ae0d22a9ee9f18152ca66f36600372c3b">CAT</a>( <a class="code" href="../../d2/dc1/a01562.html">CAT</a> next, <span class="keywordtype">int</span> sz, <span class="keywordtype">long</span> init ) {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <a class="code" href="../../d2/dc1/a01562.html#a6a0bfc6d7e6d7250b5b5056d2b990c77">_next</a> = next;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <a class="code" href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">_t</a> = <span class="keyword">new</span> <span class="keywordtype">long</span>[sz];</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <a class="code" href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">_t</a>[0] = init;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// Only add &#39;x&#39; to some slot in table, hinted at by &#39;hash&#39;.  The sum can</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// overflow.  Value is CAS&#39;d so no counts are lost.  The CAS is attempted</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// ONCE.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a7336896360f0eba7bbb60ccaea2a5737">  131</a></span>&#160;    <span class="keyword">public</span> <span class="keywordtype">long</span> <a class="code" href="../../d2/dc1/a01562.html#a7336896360f0eba7bbb60ccaea2a5737">add_if</a>( <span class="keywordtype">long</span> x, <span class="keywordtype">int</span> <a class="code" href="../../da/dcf/a01558.html#a074036c1c16302eaab17311aa96809ab">hash</a>, <a class="code" href="../../da/dcf/a01558.html">ConcurrentAutoTable</a> master ) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="keyword">final</span> <span class="keywordtype">long</span>[] t = <a class="code" href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">_t</a>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keyword">final</span> <span class="keywordtype">int</span> idx = <a class="code" href="../../da/dcf/a01558.html#a074036c1c16302eaab17311aa96809ab">hash</a> &amp; (t.length-1);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="comment">// Peel loop; try once fast</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordtype">long</span> old = t[idx];</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="keyword">final</span> <span class="keywordtype">boolean</span> ok = <a class="code" href="../../d2/dc1/a01562.html#a6db7031609cd9694b857ef0014406fac">CAS</a>( t, idx, old, old+x );</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordflow">if</span>( ok ) <span class="keywordflow">return</span> old;      <span class="comment">// Got it</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="comment">// Try harder</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordtype">int</span> cnt=0;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="keywordflow">while</span>( <span class="keyword">true</span> ) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        old = t[idx];</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="../../d2/dc1/a01562.html#a6db7031609cd9694b857ef0014406fac">CAS</a>( t, idx, old, old+x ) ) <span class="keywordflow">break</span>; <span class="comment">// Got it!</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        cnt++;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordflow">if</span>( cnt &lt; <a class="code" href="../../d2/dc1/a01562.html#a3176a8c1a34bbbf93a7bc4713177b4a1">MAX_SPIN</a> ) <span class="keywordflow">return</span> old; <span class="comment">// Allowable spin loop count</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="keywordflow">if</span>( t.length &gt;= 1024*1024 ) <span class="keywordflow">return</span> old; <span class="comment">// too big already</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="comment">// Too much contention; double array size in an effort to reduce contention</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <span class="comment">//long r = _resizers;</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="comment">//final int newbytes = (t.length&lt;&lt;1)&lt;&lt;3/*word to bytes*/;</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="comment">//while( !_resizerUpdater.compareAndSet(this,r,r+newbytes) )</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="comment">//  r = _resizers;</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="comment">//r += newbytes;</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">if</span>( master.<a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a> != <span class="keyword">this</span> ) <span class="keywordflow">return</span> old; <span class="comment">// Already doubled, don&#39;t bother</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="comment">//if( (r&gt;&gt;17) != 0 ) {      // Already too much allocation attempts?</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="comment">//  // We could use a wait with timeout, so we&#39;ll wakeup as soon as the new</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="comment">//  // table is ready, or after the timeout in any case.  Annoyingly, this</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="comment">//  // breaks the non-blocking property - so for now we just briefly sleep.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">//  //synchronized( this ) { wait(8*megs); }         // Timeout - we always wakeup</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="comment">//  try { Thread.sleep(r&gt;&gt;17); } catch( InterruptedException e ) { }</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="comment">//  if( master._cat != this ) return old;</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="comment">//}</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <a class="code" href="../../d2/dc1/a01562.html">CAT</a> newcat = <span class="keyword">new</span> <a class="code" href="../../d2/dc1/a01562.html#ae0d22a9ee9f18152ca66f36600372c3b">CAT</a>(<span class="keyword">this</span>,t.length*2,0);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="comment">// Take 1 stab at updating the CAT with the new larger size.  If this</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="comment">// fails, we assume some other thread already expanded the CAT - so we</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="comment">// do not need to retry until it succeeds.</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">while</span>( master.<a class="code" href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">_cat</a> == <span class="keyword">this</span> &amp;&amp; !master.<a class="code" href="../../da/dcf/a01558.html#a095c4286914eb55093fddc6876df6fc9">CAS_cat</a>(<span class="keyword">this</span>,newcat) ) {<span class="comment">/*empty*/</span>}</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordflow">return</span> old;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// Return the current sum of all things in the table.  Writers can be</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// updating the table furiously, so the sum is only locally accurate.</span></div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">  175</a></span>&#160;    <span class="keyword">public</span> <span class="keywordtype">long</span> <a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a>( ) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordtype">long</span> <a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a> = <a class="code" href="../../d2/dc1/a01562.html#a6a0bfc6d7e6d7250b5b5056d2b990c77">_next</a> == <span class="keyword">null</span> ? 0 : <a class="code" href="../../d2/dc1/a01562.html#a6a0bfc6d7e6d7250b5b5056d2b990c77">_next</a>.<a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a>(); <span class="comment">// Recursively get cached sum</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keyword">final</span> <span class="keywordtype">long</span>[] t = <a class="code" href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">_t</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">long</span> cnt : t ) <a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a> += cnt;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// Fast fuzzy version.  Used a cached value until it gets old, then re-up</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// the cache.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a0f817e0a3eea4bb0474428009259f2b9">  184</a></span>&#160;    <span class="keyword">public</span> <span class="keywordtype">long</span> <a class="code" href="../../d2/dc1/a01562.html#a0f817e0a3eea4bb0474428009259f2b9">estimate_sum</a>( ) {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="comment">// For short tables, just do the work</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="keywordflow">if</span>( <a class="code" href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">_t</a>.length &lt;= 64 ) <span class="keywordflow">return</span> <a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a>();</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="comment">// For bigger tables, periodically freshen a cached value</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordtype">long</span> millis = System.currentTimeMillis();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordflow">if</span>( <a class="code" href="../../d2/dc1/a01562.html#a95bdb4fcf5ea2938883b7b173639edb8">_fuzzy_time</a> != millis ) { <span class="comment">// Time marches on?</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <a class="code" href="../../d2/dc1/a01562.html#a530f45dbf243605aca8324816e39a4d6">_fuzzy_sum_cache</a> = <a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a>(); <span class="comment">// Get sum the hard way</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="../../d2/dc1/a01562.html#a95bdb4fcf5ea2938883b7b173639edb8">_fuzzy_time</a> = millis;   <span class="comment">// Indicate freshness of cached value</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/dc1/a01562.html#a530f45dbf243605aca8324816e39a4d6">_fuzzy_sum_cache</a>;  <span class="comment">// Return cached sum</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#a92e61323c0d2d87797fe718bec33d73e">  196</a></span>&#160;    <span class="keyword">public</span> String <a class="code" href="../../d2/dc1/a01562.html#a92e61323c0d2d87797fe718bec33d73e">toString</a>( ) { <span class="keywordflow">return</span> Long.toString(<a class="code" href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">sum</a>()); }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    </div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="../../d2/dc1/a01562.html#aa2ccbbf505dfab8df97bb755755c3cdd">  198</a></span>&#160;    <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dc1/a01562.html#aa2ccbbf505dfab8df97bb755755c3cdd">print</a>() { </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordtype">long</span>[] t = <a class="code" href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">_t</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      System.out.print(<span class="stringliteral">&quot;[&quot;</span>+t[0]);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=1; i&lt;t.length; i++ ) </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        System.out.print(<span class="stringliteral">&quot;,&quot;</span>+t[i]);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      System.out.print(<span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">if</span>( <a class="code" href="../../d2/dc1/a01562.html#a6a0bfc6d7e6d7250b5b5056d2b990c77">_next</a> != <span class="keyword">null</span> ) <a class="code" href="../../d2/dc1/a01562.html#a6a0bfc6d7e6d7250b5b5056d2b990c77">_next</a>.<a class="code" href="../../d2/dc1/a01562.html#aa2ccbbf505dfab8df97bb755755c3cdd">print</a>();</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aa01562_html_a95bdb4fcf5ea2938883b7b173639edb8"><div class="ttname"><a href="../../d2/dc1/a01562.html#a95bdb4fcf5ea2938883b7b173639edb8">com.cliffc.aa.util.ConcurrentAutoTable.CAT._fuzzy_time</a></div><div class="ttdeci">volatile long _fuzzy_time</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00118">ConcurrentAutoTable.java:118</a></div></div>
<div class="ttc" id="aa01558_html"><div class="ttname"><a href="../../da/dcf/a01558.html">com.cliffc.aa.util.ConcurrentAutoTable</a></div><div class="ttdoc">An auto-resizing table of.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00019">ConcurrentAutoTable.java:19</a></div></div>
<div class="ttc" id="aa01642_html_a2fcd3c4eb083b744f168496baef1afa0"><div class="ttname"><a href="../../d7/d94/a01642.html#a2fcd3c4eb083b744f168496baef1afa0">com.cliffc.aa.util.UtilUnsafe.getUnsafe</a></div><div class="ttdeci">static Unsafe getUnsafe()</div><div class="ttdoc">Fetch the Unsafe.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7f/a00287_source.html#l00019">UtilUnsafe.java:19</a></div></div>
<div class="ttc" id="aa01558_html_a9d51e34cdb03418620b2facb902b74dc"><div class="ttname"><a href="../../da/dcf/a01558.html#a9d51e34cdb03418620b2facb902b74dc">com.cliffc.aa.util.ConcurrentAutoTable.internal_size</a></div><div class="ttdeci">int internal_size()</div><div class="ttdoc">Return the internal counter striping factor.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00077">ConcurrentAutoTable.java:77</a></div></div>
<div class="ttc" id="aa01562_html_a6a0bfc6d7e6d7250b5b5056d2b990c77"><div class="ttname"><a href="../../d2/dc1/a01562.html#a6a0bfc6d7e6d7250b5b5056d2b990c77">com.cliffc.aa.util.ConcurrentAutoTable.CAT._next</a></div><div class="ttdeci">final CAT _next</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00116">ConcurrentAutoTable.java:116</a></div></div>
<div class="ttc" id="aa01642_html"><div class="ttname"><a href="../../d7/d94/a01642.html">com.cliffc.aa.util.UtilUnsafe</a></div><div class="ttdoc">Simple class to obtain access to the Unsafe object.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7f/a00287_source.html#l00015">UtilUnsafe.java:15</a></div></div>
<div class="ttc" id="aa01562_html_a6db7031609cd9694b857ef0014406fac"><div class="ttname"><a href="../../d2/dc1/a01562.html#a6db7031609cd9694b857ef0014406fac">com.cliffc.aa.util.ConcurrentAutoTable.CAT.CAS</a></div><div class="ttdeci">static boolean CAS(long[] A, int idx, long old, long nnn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00108">ConcurrentAutoTable.java:108</a></div></div>
<div class="ttc" id="aa01558_html_a4b0bab4576aff6bfb017f0d1c794bef3"><div class="ttname"><a href="../../da/dcf/a01558.html#a4b0bab4576aff6bfb017f0d1c794bef3">com.cliffc.aa.util.ConcurrentAutoTable.add</a></div><div class="ttdeci">void add(long x)</div><div class="ttdoc">Add the given value to current counter value.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00030">ConcurrentAutoTable.java:30</a></div></div>
<div class="ttc" id="aa01562_html_ae0d22a9ee9f18152ca66f36600372c3b"><div class="ttname"><a href="../../d2/dc1/a01562.html#ae0d22a9ee9f18152ca66f36600372c3b">com.cliffc.aa.util.ConcurrentAutoTable.CAT.CAT</a></div><div class="ttdeci">CAT(CAT next, int sz, long init)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00122">ConcurrentAutoTable.java:122</a></div></div>
<div class="ttc" id="aa01562_html_a0f817e0a3eea4bb0474428009259f2b9"><div class="ttname"><a href="../../d2/dc1/a01562.html#a0f817e0a3eea4bb0474428009259f2b9">com.cliffc.aa.util.ConcurrentAutoTable.CAT.estimate_sum</a></div><div class="ttdeci">long estimate_sum()</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00184">ConcurrentAutoTable.java:184</a></div></div>
<div class="ttc" id="aa01562_html_aa2ccbbf505dfab8df97bb755755c3cdd"><div class="ttname"><a href="../../d2/dc1/a01562.html#aa2ccbbf505dfab8df97bb755755c3cdd">com.cliffc.aa.util.ConcurrentAutoTable.CAT.print</a></div><div class="ttdeci">void print()</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00198">ConcurrentAutoTable.java:198</a></div></div>
<div class="ttc" id="aa01562_html_a8d374ee0df140cb2d575e357d2a64311"><div class="ttname"><a href="../../d2/dc1/a01562.html#a8d374ee0df140cb2d575e357d2a64311">com.cliffc.aa.util.ConcurrentAutoTable.CAT._unsafe</a></div><div class="ttdeci">static final Unsafe _unsafe</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00101">ConcurrentAutoTable.java:101</a></div></div>
<div class="ttc" id="aa01558_html_ad08d068d18aeb3d9164469a26e899c16"><div class="ttname"><a href="../../da/dcf/a01558.html#ad08d068d18aeb3d9164469a26e899c16">com.cliffc.aa.util.ConcurrentAutoTable.decrement</a></div><div class="ttdeci">void decrement()</div><div class="ttdoc">add with -1</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00032">ConcurrentAutoTable.java:32</a></div></div>
<div class="ttc" id="aa01558_html_a04095ff65c197cf6c490b1f066284d74"><div class="ttname"><a href="../../da/dcf/a01558.html#a04095ff65c197cf6c490b1f066284d74">com.cliffc.aa.util.ConcurrentAutoTable._cat</a></div><div class="ttdeci">volatile CAT _cat</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00085">ConcurrentAutoTable.java:85</a></div></div>
<div class="ttc" id="aa01558_html_a28979aa10c189b26a39f1d3e9a036fd1"><div class="ttname"><a href="../../da/dcf/a01558.html#a28979aa10c189b26a39f1d3e9a036fd1">com.cliffc.aa.util.ConcurrentAutoTable.intValue</a></div><div class="ttdeci">int intValue()</div><div class="ttdoc">Same as get, included for completeness.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00052">ConcurrentAutoTable.java:52</a></div></div>
<div class="ttc" id="aa01562_html_a6e66dfb342085957f2dc33ccbb12bd3b"><div class="ttname"><a href="../../d2/dc1/a01562.html#a6e66dfb342085957f2dc33ccbb12bd3b">com.cliffc.aa.util.ConcurrentAutoTable.CAT._t</a></div><div class="ttdeci">final long[] _t</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00120">ConcurrentAutoTable.java:120</a></div></div>
<div class="ttc" id="aa01558_html_a2d4cc656fb2580d38b6869c9446afcba"><div class="ttname"><a href="../../da/dcf/a01558.html#a2d4cc656fb2580d38b6869c9446afcba">com.cliffc.aa.util.ConcurrentAutoTable.toString</a></div><div class="ttdeci">String toString()</div><div class="ttdoc">Return the counter's.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00065">ConcurrentAutoTable.java:65</a></div></div>
<div class="ttc" id="aa01562_html_aa608923d1601362028a28e0b5f3b8d9a"><div class="ttname"><a href="../../d2/dc1/a01562.html#aa608923d1601362028a28e0b5f3b8d9a">com.cliffc.aa.util.ConcurrentAutoTable.CAT.rawIndex</a></div><div class="ttdeci">static long rawIndex(long[] ary, int i)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00104">ConcurrentAutoTable.java:104</a></div></div>
<div class="ttc" id="aa01558_html_a095c4286914eb55093fddc6876df6fc9"><div class="ttname"><a href="../../da/dcf/a01558.html#a095c4286914eb55093fddc6876df6fc9">com.cliffc.aa.util.ConcurrentAutoTable.CAS_cat</a></div><div class="ttdeci">boolean CAS_cat(CAT oldcat, CAT newcat)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00088">ConcurrentAutoTable.java:88</a></div></div>
<div class="ttc" id="aa01562_html_a530f45dbf243605aca8324816e39a4d6"><div class="ttname"><a href="../../d2/dc1/a01562.html#a530f45dbf243605aca8324816e39a4d6">com.cliffc.aa.util.ConcurrentAutoTable.CAT._fuzzy_sum_cache</a></div><div class="ttdeci">volatile long _fuzzy_sum_cache</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00117">ConcurrentAutoTable.java:117</a></div></div>
<div class="ttc" id="aa01562_html_a3176a8c1a34bbbf93a7bc4713177b4a1"><div class="ttname"><a href="../../d2/dc1/a01562.html#a3176a8c1a34bbbf93a7bc4713177b4a1">com.cliffc.aa.util.ConcurrentAutoTable.CAT.MAX_SPIN</a></div><div class="ttdeci">static final int MAX_SPIN</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00119">ConcurrentAutoTable.java:119</a></div></div>
<div class="ttc" id="aa01558_html_a9344a8223e6fa082967da3a2a9a537ae"><div class="ttname"><a href="../../da/dcf/a01558.html#a9344a8223e6fa082967da3a2a9a537ae">com.cliffc.aa.util.ConcurrentAutoTable.estimate_get</a></div><div class="ttdeci">long estimate_get()</div><div class="ttdoc">A cheaper get.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00060">ConcurrentAutoTable.java:60</a></div></div>
<div class="ttc" id="aa01562_html_afaab6494573adfe81eed0a4c826714b8"><div class="ttname"><a href="../../d2/dc1/a01562.html#afaab6494573adfe81eed0a4c826714b8">com.cliffc.aa.util.ConcurrentAutoTable.CAT._Lscale</a></div><div class="ttdeci">static final int _Lscale</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00103">ConcurrentAutoTable.java:103</a></div></div>
<div class="ttc" id="aa01558_html_ae319283f373baf9a27b4e2805e91bcd1"><div class="ttname"><a href="../../da/dcf/a01558.html#ae319283f373baf9a27b4e2805e91bcd1">com.cliffc.aa.util.ConcurrentAutoTable.longValue</a></div><div class="ttdeci">long longValue()</div><div class="ttdoc">Same as get, included for completeness.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00054">ConcurrentAutoTable.java:54</a></div></div>
<div class="ttc" id="aa01558_html_adccbe6ece72427d36b0cc5492c0146ce"><div class="ttname"><a href="../../da/dcf/a01558.html#adccbe6ece72427d36b0cc5492c0146ce">com.cliffc.aa.util.ConcurrentAutoTable.increment</a></div><div class="ttdeci">void increment()</div><div class="ttdoc">add with +1</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00034">ConcurrentAutoTable.java:34</a></div></div>
<div class="ttc" id="aa01562_html"><div class="ttname"><a href="../../d2/dc1/a01562.html">com.cliffc.aa.util.ConcurrentAutoTable.CAT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00098">ConcurrentAutoTable.java:98</a></div></div>
<div class="ttc" id="aa01558_html_a21fbbc25644149af7ad5113ebab0793c"><div class="ttname"><a href="../../da/dcf/a01558.html#a21fbbc25644149af7ad5113ebab0793c">com.cliffc.aa.util.ConcurrentAutoTable.print</a></div><div class="ttdeci">void print()</div><div class="ttdoc">A more verbose print than toString, showing internal structure.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00071">ConcurrentAutoTable.java:71</a></div></div>
<div class="ttc" id="aa01562_html_a92e61323c0d2d87797fe718bec33d73e"><div class="ttname"><a href="../../d2/dc1/a01562.html#a92e61323c0d2d87797fe718bec33d73e">com.cliffc.aa.util.ConcurrentAutoTable.CAT.toString</a></div><div class="ttdeci">String toString()</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00196">ConcurrentAutoTable.java:196</a></div></div>
<div class="ttc" id="aa01562_html_a7336896360f0eba7bbb60ccaea2a5737"><div class="ttname"><a href="../../d2/dc1/a01562.html#a7336896360f0eba7bbb60ccaea2a5737">com.cliffc.aa.util.ConcurrentAutoTable.CAT.add_if</a></div><div class="ttdeci">long add_if(long x, int hash, ConcurrentAutoTable master)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00131">ConcurrentAutoTable.java:131</a></div></div>
<div class="ttc" id="aa01558_html_a08789856105b475f7dd0988b78e96e84"><div class="ttname"><a href="../../da/dcf/a01558.html#a08789856105b475f7dd0988b78e96e84">com.cliffc.aa.util.ConcurrentAutoTable._catUpdater</a></div><div class="ttdeci">static AtomicReferenceFieldUpdater&lt; ConcurrentAutoTable, CAT &gt; _catUpdater</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00086">ConcurrentAutoTable.java:86</a></div></div>
<div class="ttc" id="aa01558_html_a262459cb28d48e079a9990d40aaad390"><div class="ttname"><a href="../../da/dcf/a01558.html#a262459cb28d48e079a9990d40aaad390">com.cliffc.aa.util.ConcurrentAutoTable.add_if</a></div><div class="ttdeci">long add_if(long x)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00082">ConcurrentAutoTable.java:82</a></div></div>
<div class="ttc" id="aa01562_html_affe24fc89bef3098502356c3ee538722"><div class="ttname"><a href="../../d2/dc1/a01562.html#affe24fc89bef3098502356c3ee538722">com.cliffc.aa.util.ConcurrentAutoTable.CAT.sum</a></div><div class="ttdeci">long sum()</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00175">ConcurrentAutoTable.java:175</a></div></div>
<div class="ttc" id="aa01558_html_a074036c1c16302eaab17311aa96809ab"><div class="ttname"><a href="../../da/dcf/a01558.html#a074036c1c16302eaab17311aa96809ab">com.cliffc.aa.util.ConcurrentAutoTable.hash</a></div><div class="ttdeci">static int hash()</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00091">ConcurrentAutoTable.java:91</a></div></div>
<div class="ttc" id="aa01562_html_a7ddee6cfccf05d9228d0052f54bbf8cc"><div class="ttname"><a href="../../d2/dc1/a01562.html#a7ddee6cfccf05d9228d0052f54bbf8cc">com.cliffc.aa.util.ConcurrentAutoTable.CAT._Lbase</a></div><div class="ttdeci">static final int _Lbase</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d35/a00266_source.html#l00102">ConcurrentAutoTable.java:102</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_5eb159725f84c66aafd839904a4acdd0.html">main</a></li><li class="navelem"><a class="el" href="../../dir_fd3f6763802dee1ad875f6c80eac0bda.html">java</a></li><li class="navelem"><a class="el" href="../../dir_d8517d8b842053dc3dd7dde525dd9163.html">com</a></li><li class="navelem"><a class="el" href="../../dir_56acb4c897cae467839e432eb6d90ced.html">cliffc</a></li><li class="navelem"><a class="el" href="../../dir_4bf2c2aaa4c8c297b7b3132f0a2c4126.html">aa</a></li><li class="navelem"><a class="el" href="../../dir_88cce27200b3c8b4d776f027424fbd47.html">util</a></li><li class="navelem"><a class="el" href="../../d5/d35/a00266.html">ConcurrentAutoTable.java</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
